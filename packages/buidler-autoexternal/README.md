[![npm](https://img.shields.io/npm/v/@nomiclabs/buidler-autoexternal.svg)](https://www.npmjs.com/package/@nomiclabs/buidler-autoexternal)

# buidler-autoexternal

This plugin makes testing contracts with `internal` functions easier. It autogenerates contracts where the `internal` functions are turn into `external` ones.

For example, by processing this file

```solidity
pragma solidity ^0.5.0;

// This annotation enables this plugin for this file.
// #buidler-autoexternal

contract MyContract {

    function _fun() pure internal returns (uint256)
    {
        return 123;
    }

}
```

the plugin autogenerates and compiles this one

```solidity
pragma solidity ^0.5.0;

import "<originalfile.sol>";

contract TestableMyContract is MyContract {

    function fun() pure external returns (uint256)
    {
        return super._fun();
    }

}
```

## Installation

```
npm install @nomiclabs/buidler-autoexternal
```

And add the following require to the top of your `buidler.config.js`:

`require("@nomiclabs/buidler-autoexternal")`

## Environment extensions

This plugin does not extend the Buidler Runtime Environment.

## Usage

Once you installed this plugin, the only requirement for it to work is to add an annotation in a comment (i.e. `// #buidler-autoexternal`) to the files you want this plugin to process.

When the plugin detects this annotation, new contracts will be automatically generated and compiled.

You can use the autogenerated contracts from your tests, tasks or scripts, as you'd do with your own contracts.

## Config

This plugin can by configured by setting a `autoexternal` entry in `buidler.config.js`. Its options are:

- `enableForFileAnnotation: string`: the annotation which indicates that a file has to be processed by this plugin. Default value: `"#buidler-autoexternal"`.

- `exportableFunctionNamePattern: RegExp`: a `RegExp` run against internal functions' names. If it matches, they get exported. Default value: `/^_/`.

- `contractNameTransformer: (name: string) => string`: a function to transform contracts' names to autogenrated contracts' names. By default it will prefix `"Testable"` to the contact's name.

- `functiontNameTransformer: (name: string) => string`: a function to transform the `internal` functions' names into `external` ones. By default it will remove the first character of the function's name, a `_`.

The default config will look like this:

```js
module.exports = {
  autoexternal: {
    enableForFileAnnotation: "#buidler-autoexternal",
    exportableFunctionNamePattern: /^_/,
    contractNameTransformer: name => "Testable" + name,
    functionNameTransformer: name => name.substr(1)
  }
};
```
